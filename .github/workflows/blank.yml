name: "Godot 4.5 GUT CI"
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          lfs: true

      - name: Setup Godot 4.5
        uses: lihop/setup-godot@v3
        with:
          # Use the stable 4.5.1 release for maximum reliability
          version: 4.5.1-stable 

      - name: Import Assets
        run: godot --headless --editor --quit

      - name: Run GUT Tests
        shell: bash
        run: |
          # Headless mode is mandatory for CI; --quit ensures the runner stops after completion
          # GODOT_DISABLE_LEAK_CHECKS=1 is often used to avoid false failures from engine-level leak logs
          export GODOT_DISABLE_LEAK_CHECKS=1
          godot --headless -s --path "$PWD" addons/gut/gut_cmdln.gd -gexit

